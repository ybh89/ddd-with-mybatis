# Mybatis 환경에서 DDD 데모 프로젝트

## 프로젝트 개요
* mybatis 환경에서 DDD를 구현하기 위한 여러가지 패턴의 아이디어를 데모로 구현한다.
* mybatis 환경에서 JPA 처럼 자바를 객체지향적으로 사용하기 위한 아이디어를 데모로 구현한다.
* 아이디어가 있다면 버전 패키지를 만들고 구현해볼 수 있다.

## 기술 스택
* Java 1.8
* h2 in-memory
* mybatis
* Spring Data JDBC
* Spring Boot 2.6.1
* Gradle Project
* Lombok
* RestAssured

### 데모 도메인 소개
* Maker(제조사), Brand(브랜드), Series(시리즈)로 구성
* V3 부터 MakerSynonym(제조사 동의어), BrandSynonym(브랜드 동의어), URL(제조사 사이트), URL(브랜드 사이트) 추가됨.
* 제조사->브랜드->시리즈 로 단반향으로 구현
* 제조사->브랜드 는 일대다 관계
* 브랜드->시리즈 는 일대다 관계
* 제조사, 브랜드는 수정은 가능하나 삭제될 수 없다. 시리즈만 삭제 가능.
* 제조사, 브랜드, 시리즈는 엔티티
* 제조사 동의어, 브랜드 동의어는 값 타입 컬렉션
* 제조사 사이트, 브랜드 사이트는 값 타입
* 제조사->제조사 동의어 는 일대다 관계
* 브랜드->브랜드 동의어 는 일대다 관계

### V1
* 도메인 모델 패턴으로 비지니스 로직은 도메인에 있다고 가정(실제 비즈니스로직은 없지만..)
* 서비스에서 각 도메인에 해당하는 Repository 로 저장하고 수정고 삭제한다.
* 수정될때, 업데이트될 제조사나 브랜드나 시리즈는 식별자(id)가 들어온다.
* 수정될때, 추가될 브랜드나 시리즈는 식별자(id)가 없다.
* 수정될때, 삭제될 시리즈는 기존 브랜드에는 존재하나 요청한 브랜드에는 존재하지 않는다.

### V2
* V1에서 서비스에서 실제 데이터를 어디에 어떻게 저장할지, 수정할지, 삭제할지 결정하기 때문에 해당 책임을 AggregateRepository에 위임한다.
* Aggregate 단위로 추가, 수정, 삭제, 조회 되야한다.
* V1에서는 이미 추가, 조회는 Aggregate 단위로 구현되어 있음.
* 비즈니스가 추가되면 Aggregate root인 Maker를 통해 수행되야한다.

### V3
* ~~엔티티를 타입으로 정의하기 위해 인터페이스를 만들었다.~~ 엔티티를 어노테이션으로 정의
* 기존에는 식별자만 있으면 업데이트 쿼리가 나가는 구조이기 때문에, 실제 엔티티의 값이 다른지 비교해주는 로직을 리픅렉션으로 구현하였다.
* 변경 감지를 무시할 수 있는 어노테이션 정의(필드, 클래스 레벨에서 적용 가능)
* 제조사 동의어, 제조사 사이트, 브랜드 동의어, 브랜드 사이트 값 타입 도메인 추가(더 복잡한 예제로 변경)

### 문제점
* V1 - 도메인 모델 패턴이지만 도메인 주도설계는 아니다.
* V2 - 도메인 모델 패턴 + 애그리거트 패턴이지만.. 변경감지(Dirty Checking)가 도메인에 의존적이다.
* 지금은 변경감지를 도메인마다 구현해야하는 구조. 물론 모든 도메인이 적용될 수 있는 변경감지 모듈을 만들면 좋지만..
* 그럴거면 그냥 JPA 를 도입하는게 더 빠르지 않을까? 뭔가 좋은 생각이 없을까?
* maker.update() 를 하면 실제 JPA 처럼 변경감지가 실행되어 쿼리까지 나가게 할 수 없을까?